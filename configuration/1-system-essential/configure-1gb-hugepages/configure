#!/bin/sh

cd -- "$(dirname -- "$0")"
./check && exit

grep -q pdpe1gb /proc/cpuinfo || exit 1

grep -q '^GRUB_CMDLINE_LINUX_DEFAULT=[^#]*\<default_hugepagesz=1G\>' /etc/default/grub || {
    sed -i "/^GRUB_CMDLINE_LINUX_DEFAULT=/ s@\"@\"default_hugepagesz=1G @" /etc/default/grub
    grub-mkconfig -o /boot/grub/grub.cfg
}

