#!/bin/sh

command -v ethtool > /dev/null || exit 1
command -v crontab > /dev/null || exit 1

DIALOG_FILE="$(mktemp -p /tmp dialog_file.XXXXXX)" || exit 1
trap 'rm "$DIALOG_FILE"' EXIT

INTERFACE="eth0"

while true
do
    dialog --erase-on-exit --inputbox "Input name of network interface" \
        9 25 "$INTERFACE" \
        2> "$DIALOG_FILE" || {
        echo "Canceled"
        exit
    }

    INTERFACE="$(cat -- "$DIALOG_FILE")"
    [ "$INTERFACE" ] && ip link show "$INTERFACE" > /dev/null 2>&1 && break || continue
done

ethtool -s "$INTERFACE" wol g &&
    crontab -l | { cat; echo '@reboot /usr/bin/ethtool -s "$INTERFACE" wol g'; } | crontab -

